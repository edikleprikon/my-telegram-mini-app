<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Дурак со ставками | Telegram Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #f5f5f5;
            --card-color: #ffffff;
            --accent-color: #5682a3;
            --text-color: #333333;
            --button-color: #40a7e3;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 10px 0;
            background-color: var(--accent-color);
            color: white;
        }
        
        .game-table {
            background-color: #2e7d32;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            min-height: 300px;
            position: relative;
        }
        
        .card {
            width: 80px;
            height: 120px;
            background-color: var(--card-color);
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            cursor: pointer;
            user-select: none;
            position: absolute;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .player-hand {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .controls {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }
        
        button {
            background-color: var(--button-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .betting-panel {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
        }
        
        .balance {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Дурак со ставками</h1>
    </div>
    
    <div class="container">
        <div class="balance">
            Баланс: <span id="balance">1000</span> ₽
        </div>
        
        <div id="betting-panel" class="betting-panel">
            <h2>Сделайте ставку</h2>
            <div>
                <button onclick="changeBet(-10)">-10</button>
                <span id="current-bet" style="margin: 0 15px; font-size: 18px;">50</span> ₽
                <button onclick="changeBet(10)">+10</button>
            </div>
            <button onclick="startGame()" style="margin-top: 15px;">Играть</button>
        </div>
        
        <div id="game-container" style="display: none;">
            <div class="game-table" id="game-table">
                <!-- Карты будут отображаться здесь -->
            </div>
            
            <div class="player-hand" id="player-hand">
                <!-- Карты игрока -->
            </div>
            
            <div class="controls">
                <button id="take-button" onclick="takeCards()">Взять</button>
                <button id="pass-button" onclick="passTurn()">Бито</button>
            </div>
        </div>
    </div>

    <script>
        // Инициализация Telegram Web App
        let tg = window.Telegram.WebApp;
        tg.expand();
        
        // Игровые переменные
        let balance = 1000;
        let currentBet = 50;
        let deck = [];
        let playerHand = [];
        let botHand = [];
        let tableCards = [];
        let trumpCard = null;
        let isPlayerTurn = true;
        
        // Обновление интерфейса
        function updateBalance() {
            document.getElementById('balance').textContent = balance;
        }
        
        function changeBet(amount) {
            currentBet += amount;
            if (currentBet < 10) currentBet = 10;
            if (currentBet > balance) currentBet = balance;
            document.getElementById('current-bet').textContent = currentBet;
        }
        
        // Инициализация игры
        function startGame() {
            if (currentBet > balance) {
                alert('Недостаточно средств!');
                return;
            }
            
            // Скрываем панель ставок, показываем игровое поле
            document.getElementById('betting-panel').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            
            // Создаем колоду
            initializeDeck();
            shuffleDeck();
            
            // Раздаем карты
            dealCards();
            
            // Определяем козырь
            trumpCard = deck.pop();
            
            // Обновляем интерфейс
            renderGame();
        }
        
        function initializeDeck() {
            const suits = ['hearts', 'diamonds', 'clubs', 'spades'];
            const ranks = ['6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            
            deck = [];
            for (let suit of suits) {
                for (let rank of ranks) {
                    deck.push({ suit, rank });
                }
            }
        }
        
        function shuffleDeck() {
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
        }
        
        function dealCards() {
            playerHand = [];
            botHand = [];
            
            for (let i = 0; i < 6; i++) {
                playerHand.push(deck.pop());
                botHand.push(deck.pop());
            }
        }
        
        function renderGame() {
            // Очищаем игровое поле
            const gameTable = document.getElementById('game-table');
            gameTable.innerHTML = '';
            
            // Отображаем козырь
            const trumpElement = document.createElement('div');
            trumpElement.className = 'card';
            trumpElement.style.position = 'static';
            trumpElement.textContent = `${getRankSymbol(trumpCard.rank)}${getSuitSymbol(trumpCard.suit)}`;
            gameTable.appendChild(trumpElement);
            
            // Отображаем карты на столе
            tableCards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.style.left = `${100 + index * 30}px`;
                cardElement.style.top = '100px';
                cardElement.textContent = `${getRankSymbol(card.rank)}${getSuitSymbol(card.suit)}`;
                gameTable.appendChild(cardElement);
            });
            
            // Отображаем карты игрока
            const playerHandElement = document.getElementById('player-hand');
            playerHandElement.innerHTML = '';
            
            playerHand.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.style.position = 'relative';
                cardElement.textContent = `${getRankSymbol(card.rank)}${getSuitSymbol(card.suit)}`;
                cardElement.onclick = () => playCard(index);
                playerHandElement.appendChild(cardElement);
            });
        }
        
        function getSuitSymbol(suit) {
            const symbols = {
                'hearts': '♥',
                'diamonds': '♦',
                'clubs': '♣',
                'spades': '♠'
            };
            return symbols[suit] || '';
        }
        
        function getRankSymbol(rank) {
            return rank;
        }
        
        function playCard(cardIndex) {
            if (!isPlayerTurn) return;
            
            const card = playerHand[cardIndex];
            
            // Проверяем, можно ли ходить этой картой
            if (tableCards.length === 0 || canBeat(card, tableCards[0])) {
                tableCards.push(card);
                playerHand.splice(cardIndex, 1);
                isPlayerTurn = false;
                
                // Ход бота
                setTimeout(botTurn, 1000);
            }
            
            renderGame();
        }
        
        function canBeat(attackingCard, defendingCard) {
            // Простая логика проверки возможности побить карту
            // В реальной игре нужно учитывать козыри и старшинство карт
            const trumpSuit = trumpCard.suit;
            
            if (attackingCard.suit === defendingCard.suit) {
                return getCardValue(attackingCard) > getCardValue(defendingCard);
            } else if (attackingCard.suit === trumpSuit) {
                return true;
            }
            
            return false;
        }
        
        function getCardValue(card) {
            const values = {
                '6': 6, '7': 7, '8': 8, '9': 9, '10': 10,
                'J': 11, 'Q': 12, 'K': 13, 'A': 14
            };
            return values[card.rank] || 0;
        }
        
        function botTurn() {
            // Простая логика бота
            // В реальной игре нужно реализовать более сложный ИИ
            
            if (tableCards.length === 0) {
                // Бот ходит first
                const playableCards = botHand;
                if (playableCards.length > 0) {
                    const cardToPlay = playableCards[0];
                    tableCards.push(cardToPlay);
                    botHand.splice(botHand.indexOf(cardToPlay), 1);
                }
            } else {
                // Бот пытается побить карту
                const cardToBeat = tableCards[tableCards.length - 1];
                const playableCards = botHand.filter(card => canBeat(card, cardToBeat));
                
                if (playableCards.length > 0) {
                    const cardToPlay = playableCards[0];
                    tableCards.push(cardToPlay);
                    botHand.splice(botHand.indexOf(cardToPlay), 1);
                } else {
                    // Бот берет карты
                    tableCards.forEach(card => botHand.push(card));
                    tableCards = [];
                }
            }
            
            isPlayerTurn = true;
            renderGame();
            checkGameEnd();
        }
        
        function takeCards() {
            // Игрок берет карты
            tableCards.forEach(card => playerHand.push(card));
            tableCards = [];
            isPlayerTurn = false;
            
            renderGame();
            setTimeout(botTurn, 1000);
        }
        
        function passTurn() {
            // Игрок говорит "Бито"
            tableCards = [];
            isPlayerTurn = false;
            
            // Добираем карты
            while (playerHand.length < 6 && deck.length > 0) {
                playerHand.push(deck.pop());
            }
            
            while (botHand.length < 6 && deck.length > 0) {
                botHand.push(deck.pop());
            }
            
            renderGame();
            setTimeout(botTurn, 1000);
        }
        
        function checkGameEnd() {
            if (playerHand.length === 0 && deck.length === 0) {
                endGame(true);
            } else if (botHand.length === 0 && deck.length === 0) {
                endGame(false);
            }
        }
        
        function endGame(playerWon) {
            if (playerWon) {
                balance += currentBet;
                alert('Вы выиграли! +' + currentBet + '₽');
            } else {
                balance -= currentBet;
                alert('Вы проиграли! -' + currentBet + '₽');
            }
            
            updateBalance();
            
            // Возвращаем к панели ставок
            document.getElementById('betting-panel').style.display = 'block';
            document.getElementById('game-container').style.display = 'none';
            
            // Если баланс нулевой, предлагаем начать заново
            if (balance <= 0) {
                if (confirm('Ваш баланс опустился до нуля. Начать заново?')) {
                    balance = 1000;
                    updateBalance();
                }
            }
        }
        
        // Инициализация при загрузке
        updateBalance();
    </script>
</body>
</html>
