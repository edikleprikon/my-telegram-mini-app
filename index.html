<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFT Gift Market - TON Blockchain</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #fff;
            --tg-theme-text-color: #222;
            --tg-theme-button-color: #40a7e3;
            --tg-theme-button-text-color: #fff;
            --tg-theme-secondary-bg-color: #f1f1f1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        }

        body {
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            padding: 16px;
            max-width: 100%;
            overflow-x: hidden;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            margin-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0088cc;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ton-badge {
            background-color: #0088cc;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .balance {
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .ton-icon {
            width: 16px;
            height: 16px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #dee2e6;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #0088cc;
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 8px;
        }

        .tab {
            padding: 10px 16px;
            background-color: var(--tg-theme-secondary-bg-color);
            border-radius: 12px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .tab.active {
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
        }

        .nft-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }

        .nft-card {
            background-color: var(--tg-theme-secondary-bg-color);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .nft-card:active {
            transform: scale(0.98);
        }

        .nft-image {
            width: 100%;
            aspect-ratio: 1/1;
            object-fit: cover;
            background-color: #f1f3f5;
        }

        .nft-info {
            padding: 12px;
        }

        .nft-name {
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .nft-price {
            color: #0088cc;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .buy-button {
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 500;
            cursor: pointer;
        }

        .buy-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            padding: 16px;
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background-color: var(--tg-theme-bg-color);
            border-radius: 12px;
            padding: 20px;
            width: 100%;
            max-width: 400px;
            transform: translateY(20px);
            transition: transform 0.3s;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .modal-title {
            font-weight: 600;
            font-size: 1.2rem;
        }

        .close-button {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #6c757d;
        }

        .modal-image {
            width: 100%;
            border-radius: 12px;
            margin-bottom: 16px;
            aspect-ratio: 1/1;
            object-fit: cover;
            background-color: #f1f3f5;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .modal-button {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: none;
            font-weight: 500;
            cursor: pointer;
        }

        .cancel-button {
            background-color: var(--tg-theme-secondary-bg-color);
            color: var(--tg-theme-text-color);
        }

        .confirm-button {
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .connect-wallet {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            padding: 20px;
            text-align: center;
        }

        .wallet-icon {
            font-size: 3rem;
            color: #0088cc;
        }

        .wallet-button {
            background-color: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 500;
            cursor: pointer;
            margin-top: 10px;
        }

        .transaction-status {
            padding: 16px;
            border-radius: 12px;
            margin-top: 16px;
            text-align: center;
        }

        .transaction-pending {
            background-color: #fff3cd;
            color: #856404;
        }

        .transaction-success {
            background-color: #d4edda;
            color: #155724;
        }

        .transaction-error {
            background-color: #f8d7da;
            color: #721c24;
        }

        @media (min-width: 768px) {
            .nft-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <span>NFT Gift Market</span>
                <span class="ton-badge">TON</span>
            </div>
            <div class="user-info">
                <div class="balance" id="userBalance">
                    <svg class="ton-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2"/>
                        <path d="M9.5 8.5C9.5 8.5 11 7.5 12.5 7.5C14 7.5 15.5 8.5 15.5 8.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M8.5 11.5C8.5 11.5 9 11 10 11C11 11 12.5 12 13.5 12C14.5 12 15.5 11.5 15.5 11.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <path d="M7.5 14.5C7.5 14.5 9 13.5 10.5 13.5C12 13.5 13.5 14.5 13.5 14.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <span id="balanceAmount">0</span>
                </div>
                <div class="avatar" id="userAvatar">U</div>
            </div>
        </header>

        <div id="walletNotConnected" class="connect-wallet">
            <div class="wallet-icon">üíé</div>
            <h3>–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∫–æ—à–µ–ª—ë–∫ TON</h3>
            <p>–î–ª—è —Ç–æ—Ä–≥–æ–≤–ª–∏ NFT –ø–æ–¥–∞—Ä–∫–∞–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª—ë–∫ TON</p>
            <button class="wallet-button" id="connectWalletBtn">–ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª—ë–∫</button>
        </div>

        <div id="appContent" style="display: none;">
            <div class="tabs">
                <div class="tab active" data-tab="market">–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</div>
                <div class="tab" data-tab="my-nfts">–ú–æ–∏ NFT</div>
                <div class="tab" data-tab="activity">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
            </div>

            <div id="marketTab" class="tab-content">
                <div class="nft-grid" id="nftMarketGrid">
                    <!-- NFT cards will be generated here -->
                </div>
            </div>

            <div id="myNftsTab" class="tab-content" style="display: none;">
                <div class="nft-grid" id="myNftsGrid">
                    <!-- User's NFT cards will be generated here -->
                </div>
            </div>

            <div id="activityTab" class="tab-content" style="display: none;">
                <div class="empty-state">
                    <div class="empty-state-icon">üìä</div>
                    <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤–∞—à–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="nftModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalNftName">NFT Name</div>
                <button class="close-button" id="closeModal">&times;</button>
            </div>
            <div class="modal-image" id="modalNftImage" style="display: flex; align-items: center; justify-content: center; font-size: 64px;"></div>
            <div class="nft-price">
                <span id="modalNftPrice">0 TON</span>
                <button class="buy-button" id="buyNftButton">–ö—É–ø–∏—Ç—å</button>
            </div>
            <div id="transactionStatus" class="transaction-status" style="display: none;"></div>
            <div class="modal-actions">
                <button class="modal-button cancel-button" id="cancelButton">–û—Ç–º–µ–Ω–∞</button>
                <button class="modal-button confirm-button" id="confirmButton">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–∫—É–ø–∫—É</button>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        // –ò–º–∏—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let userData = {
            id: tg.initDataUnsafe.user?.id || 1,
            username: tg.initDataUnsafe.user?.username || "User",
            balance: 0,
            nfts: [],
            walletConnected: false,
            address: null
        };

        // –ò–º–∏—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö NFT (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∏–∑ –±–ª–æ–∫—á–µ–π–Ω–∞)
        const nftData = [
            { 
                id: 1, 
                name: "–ó–æ–ª–æ—Ç–∞—è –∑–≤–µ–∑–¥–∞", 
                price: 0.5, 
                image: "‚≠ê", 
                rarity: "common",
                owner: null,
                collection: "TG Gifts"
            },
            { 
                id: 2, 
                name: "–ë—Ä–∏–ª–ª–∏–∞–Ω—Ç–æ–≤–æ–µ —Å–µ—Ä–¥—Ü–µ", 
                price: 1.5, 
                image: "üíé", 
                rarity: "rare",
                owner: null,
                collection: "TG Gifts"
            },
            { 
                id: 3, 
                name: "–û–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä", 
                price: 2.5, 
                image: "üî•", 
                rarity: "epic",
                owner: null,
                collection: "TG Gifts"
            },
            { 
                id: 4, 
                name: "–†–∞–¥—É–∂–Ω–∞—è —Ä–∞–∫–µ—Ç–∞", 
                price: 5, 
                image: "üöÄ", 
                rarity: "legendary",
                owner: null,
                collection: "TG Gifts"
            },
            { 
                id: 5, 
                name: "–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ª—É–Ω–∞", 
                price: 7.5, 
                image: "üåï", 
                rarity: "mythical",
                owner: null,
                collection: "TG Gifts"
            },
            { 
                id: 6, 
                name: "–ú–∞–≥–∏—á–µ—Å–∫–∏–π –∫—Ä–∏—Å—Ç–∞–ª–ª", 
                price: 10, 
                image: "üîÆ", 
                rarity: "mythical",
                owner: null,
                collection: "TG Gifts"
            }
        ];

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const userBalanceElement = document.getElementById('userBalance');
        const balanceAmountElement = document.getElementById('balanceAmount');
        const nftMarketGrid = document.getElementById('nftMarketGrid');
        const myNftsGrid = document.getElementById('myNftsGrid');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const nftModal = document.getElementById('nftModal');
        const modalNftName = document.getElementById('modalNftName');
        const modalNftImage = document.getElementById('modalNftImage');
        const modalNftPrice = document.getElementById('modalNftPrice');
        const buyNftButton = document.getElementById('buyNftButton');
        const closeModal = document.getElementById('closeModal');
        const cancelButton = document.getElementById('cancelButton');
        const confirmButton = document.getElementById('confirmButton');
        const transactionStatus = document.getElementById('transactionStatus');
        const connectWalletBtn = document.getElementById('connectWalletBtn');
        const walletNotConnected = document.getElementById('walletNotConnected');
        const appContent = document.getElementById('appContent');
        const userAvatar = document.getElementById('userAvatar');

        let selectedNft = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function initApp() {
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (tg.initDataUnsafe.user) {
                userAvatar.textContent = tg.initDataUnsafe.user.first_name.charAt(0);
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞, –ø–æ–¥–∫–ª—é—á–µ–Ω –ª–∏ –∫–æ—à–µ–ª–µ–∫ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è —á–µ—Ä–µ–∑ TON Connect)
            const walletConnected = localStorage.getItem('walletConnected');
            if (walletConnected === 'true') {
                userData.walletConnected = true;
                userData.address = localStorage.getItem('walletAddress');
                showAppContent();
                simulateWalletConnection();
            } else {
                showWalletConnect();
            }
            
            setupEventListeners();
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞
        function showWalletConnect() {
            walletNotConnected.style.display = 'flex';
            appContent.style.display = 'none';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function showAppContent() {
            walletNotConnected.style.display = 'none';
            appContent.style.display = 'block';
            updateBalance();
            renderMarketplace();
        }

        // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ TON
        function simulateWalletConnection() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TON Connect
            userData.balance = 15.5; // –ü—Ä–∏–º–µ—Ä –±–∞–ª–∞–Ω—Å–∞ –≤ TON
            updateBalance();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
        function updateBalance() {
            balanceAmountElement.textContent = `${userData.balance} TON`;
        }

        // –†–µ–Ω–¥–µ—Ä –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞
        function renderMarketplace() {
            nftMarketGrid.innerHTML = '';
            nftData.forEach(nft => {
                if (!nft.owner || nft.owner !== userData.address) {
                    const nftCard = createNftCard(nft);
                    nftMarketGrid.appendChild(nftCard);
                }
            });
        }

        // –†–µ–Ω–¥–µ—Ä –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function renderMyNfts() {
            myNftsGrid.innerHTML = '';
            
            const myNfts = nftData.filter(nft => nft.owner === userData.address);
            
            if (myNfts.length === 0) {
                myNftsGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üéÅ</div>
                        <p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç NFT –ø–æ–¥–∞—Ä–∫–æ–≤</p>
                    </div>
                `;
                return;
            }
            
            myNfts.forEach(nft => {
                const nftCard = createNftCard(nft, true);
                myNftsGrid.appendChild(nftCard);
            });
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ NFT
        function createNftCard(nft, isOwned = false) {
            const card = document.createElement('div');
            card.className = 'nft-card';
            card.dataset.id = nft.id;
            
            const backgroundColor = getRarityColor(nft.rarity);
            
            card.innerHTML = `
                <div class="nft-image" style="background-color: ${backgroundColor}; display: flex; align-items: center; justify-content: center; font-size: 48px;">
                    ${nft.image}
                </div>
                <div class="nft-info">
                    <div class="nft-name">${nft.name}</div>
                    <div class="nft-price">
                        <span>${isOwned ? '–í–∞—à NFT' : `${nft.price} TON`}</span>
                        ${!isOwned ? '<button class="buy-button">–ö—É–ø–∏—Ç—å</button>' : ''}
                    </div>
                </div>
            `;
            
            if (!isOwned) {
                card.querySelector('.buy-button').addEventListener('click', (e) => {
                    e.stopPropagation();
                    openNftModal(nft);
                });
            }
            
            card.addEventListener('click', () => {
                openNftModal(nft, isOwned);
            });
            
            return card;
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ –ø–æ —Ä–µ–¥–∫–æ—Å—Ç–∏
        function getRarityColor(rarity) {
            const colors = {
                common: '#e9ecef',
                rare: '#a3d9ff',
                epic: '#d0bfff',
                legendary: '#ffd8a8',
                mythical: '#ffa8a8'
            };
            return colors[rarity] || '#e9ecef';
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ NFT
        function openNftModal(nft, isOwned = false) {
            selectedNft = nft;
            modalNftName.textContent = nft.name;
            modalNftImage.textContent = nft.image;
            modalNftImage.style.backgroundColor = getRarityColor(nft.rarity);
            modalNftPrice.textContent = isOwned ? '–í–∞—à NFT' : `${nft.price} TON`;
            transactionStatus.style.display = 'none';
            
            if (isOwned) {
                buyNftButton.style.display = 'none';
                confirmButton.style.display = 'none';
                cancelButton.textContent = '–ó–∞–∫—Ä—ã—Ç—å';
            } else {
                buyNftButton.style.display = 'block';
                confirmButton.style.display = 'block';
                cancelButton.textContent = '–û—Ç–º–µ–Ω–∞';
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏
                if (userData.balance < nft.price) {
                    buyNftButton.disabled = true;
                    buyNftButton.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON';
                    confirmButton.disabled = true;
                } else {
                    buyNftButton.disabled = false;
                    buyNftButton.textContent = '–ö—É–ø–∏—Ç—å';
                    confirmButton.disabled = false;
                }
            }
            
            nftModal.classList.add('active');
        }

        // –ü–æ–∫—É–ø–∫–∞ NFT
        function buyNft() {
            if (!selectedNft) return;
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –æ–∂–∏–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            transactionStatus.style.display = 'block';
            transactionStatus.className = 'transaction-status transaction-pending';
            transactionStatus.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏...';
            
            // –°–∏–º—É–ª—è—Ü–∏—è –±–ª–æ–∫—á–µ–π–Ω-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ TON API)
            setTimeout(() => {
                if (userData.balance >= selectedNft.price) {
                    // –°–∏–º—É–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                    userData.balance -= selectedNft.price;
                    selectedNft.owner = userData.address;
                    
                    updateBalance();
                    renderMarketplace();
                    renderMyNfts();
                    
                    // –ü–æ–∫–∞–∑–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–π —Å—Ç–∞—Ç—É—Å
                    transactionStatus.className = 'transaction-status transaction-success';
                    transactionStatus.textContent = `–í—ã —É—Å–ø–µ—à–Ω–æ –ø—Ä–∏–æ–±—Ä–µ–ª–∏ "${selectedNft.name}"!`;
                    
                    // –û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–æ–ø–∫–∏
                    confirmButton.style.display = 'none';
                    cancelButton.textContent = '–ó–∞–∫—Ä—ã—Ç—å';
                    
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø–∏—Å—å –≤ –±–ª–æ–∫—á–µ–π–Ω
                    console.log(`NFT ${selectedNft.id} purchased by ${userData.address}`);
                } else {
                    // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
                    transactionStatus.className = 'transaction-status transaction-error';
                    transactionStatus.textContent = '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –ø–æ–∫—É–ø–∫–∏';
                }
            }, 2000);
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeNftModal() {
            nftModal.classList.remove('active');
            selectedNft = null;
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞ TON
        function connectWallet() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TON Connect
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å–∏–º—É–ª–∏—Ä—É–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –∫–æ—à–µ–ª—å–∫–∞
            const address = 'EQ' + Math.random().toString(36).substring(2, 12) + Math.random().toString(36).substring(2, 12);
            
            userData.walletConnected = true;
            userData.address = address;
            userData.balance = 15.5; // –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –≤ TON
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
            localStorage.setItem('walletConnected', 'true');
            localStorage.setItem('walletAddress', address);
            
            showAppContent();
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            tg.showPopup({
                title: '–ö–æ—à–µ–ª—ë–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω',
                message: `–í–∞—à –∞–¥—Ä–µ—Å: ${address}`,
                buttons: [{ type: 'ok' }]
            });
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    
                    // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    
                    // –ü–æ–∫–∞–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                    tabContents.forEach(content => {
                        content.style.display = 'none';
                    });
                    
                    document.getElementById(`${tabName}Tab`).style.display = 'block';
                    
                    // –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ "–ú–æ–∏ NFT", –æ–±–Ω–æ–≤–ª—è–µ–º –µ—ë
                    if (tabName === 'my-nfts') {
                        renderMyNfts();
                    }
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            closeModal.addEventListener('click', closeNftModal);
            cancelButton.addEventListener('click', closeNftModal);
            buyNftButton.addEventListener('click', () => {
                document.querySelector('.modal-actions').style.display = 'flex';
            });
            confirmButton.addEventListener('click', buyNft);
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
            nftModal.addEventListener('click', (e) => {
                if (e.target === nftModal) {
                    closeNftModal();
                }
            });
            
            // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
            connectWalletBtn.addEventListener('click', connectWallet);
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
